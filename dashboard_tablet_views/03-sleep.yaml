# SLEEP VIEW: BEDTIME & WAKEUP
title: Bedtime & wakeup
path: sleep
type: custom:grid-layout
theme: ios-dark-mode
background: center / cover no-repeat url("/local/ui/bg-gradient3.png") fixed
layout: 
  grid-template-columns: 24% 1fr
  grid-template-areas: '"sidebar main"'
  grid-template-rows: min-content
  padding: 0px
  margin: 0px
cards:
  # SIDEBAR CONTENTS
  - type: custom:decluttering-card
    template: tablet_sidebar
    variables:
      - active_link: "sleep"

  # MAIN VIEW CONTENT
  - type: custom:mod-card
    view_layout:
      grid-area: main
    card_mod:
      # Add 5% padding on both sides of the main content
      style: |
        ha-card {
          padding: 12px 5vw;
        }
    card:
      type: vertical-stack
      cards:
        # IMAGE/TITLE CARDS
        - type: horizontal-stack
          cards:
          # WAKE-UP TITLE
          - type: picture
            image: /local/ui/wakeup-vibe.png
          # BEDTIME TITLE
          - type: picture
            image: /local/ui/bedtime-vibe.png
          
        # TIMER-PICKERS
        - type: horizontal-stack
          cards:
          # WAKE-UP TIME-PICKER
          - type: custom:state-switch
            entity: sensor.wakeup_display_time
            default: 'weekday'
            states:
              weekday:
                type: custom:button-card
                template: time_picker_card
                entity: input_datetime.wakeup_alarm_weekdays
                variables:
                  enableEntity: "input_boolean.wakeup_alarm_active"
                  enableIconColor: "#ff9800"
                  enableOnIcon: 'mdi:alarm-check' 
                  enableOffIcon: 'mdi:alarm-off'
              weekend:
                type: custom:button-card
                template: time_picker_card
                entity: input_datetime.wakeup_alarm_weekends
                variables:
                  enableEntity: "input_boolean.wakeup_alarm_active"
                  enableIconColor: "#ff9800"
                  enableOnIcon: 'mdi:alarm-check' 
                  enableOffIcon: 'mdi:alarm-off'
          # BEDTIME TIME-TRIGGER
          - type: custom:state-switch
            entity: sensor.bedtime_display_time
            default: 'weekday'
            states:
              weekday:
                type: custom:button-card
                template: time_picker_card
                entity: input_datetime.bedtime_trigger_weekdays
                variables:
                  enableEntity: "input_boolean.bedtime_trigger_active"
                  enableIconColor: "#1ac8ed"
                  enableOnIcon: 'mdi:bed-clock' 
                  enableOffIcon: 'mdi:bed-empty'
              weekend:
                type: custom:button-card
                template: time_picker_card
                entity: input_datetime.bedtime_trigger_weekends
                variables:
                  enableEntity: "input_boolean.bedtime_trigger_active"
                  enableIconColor: "#1ac8ed"
                  enableOnIcon: 'mdi:bed-clock' 
                  enableOffIcon: 'mdi:bed-empty'
          
        # SCHEDULES
        - type: horizontal-stack
          cards:
          # WAKE-UP SCHEDULE
          - type: custom:mod-card
            card_mod:
              style: |
                ha-card {
                  background: var(--ha-card-background);
                }
            card:
              type: custom:layout-card
              layout_type: vertical
              layout:
                margin: 0px
                padding: var(--ha-card-padding) 0px
              cards:
                # Wake-up light start
                - type: custom:button-card
                  template: sleep_schedule_line
                  entity: sensor.wakeup_light_start_time
                  name: Wake-up light
                  icon: mdi:sun-angle
                # Alarm time: Sound start
                - type: custom:button-card
                  template: sleep_schedule_line
                  entity: sensor.wakeup_next_alarm_time
                  name: Wake-up audio
                  icon: mdi:alarm-note
                # Alarm intensifies
                - type: custom:button-card
                  template: sleep_schedule_line
                  entity: input_datetime.wakeup_15min_after
                  name: Blinds + audio intensifies
                  icon: mdi:roller-shade
          # BEDTIME SCHEDULE
          - type: custom:mod-card
            card_mod:
              style: |
                ha-card {
                  background: var(--ha-card-background);
                }
            card:
              type: custom:layout-card
              layout_type: vertical
              layout:
                margin: 0px
                padding: var(--ha-card-padding) 0px
              cards:
                # 1. Heated sheet start
                - type: custom:button-card
                  template: sleep_schedule_line
                  entity: sensor.bedtime_heated_sheet_start_time
                  name: Heated sheet preheating
                  icon: mdi:heating-coil
                # 2. Curtains close
                # 3. Bedtime target
                - type: custom:button-card
                  template: sleep_schedule_line
                  entity: sensor.bedtime_next_trigger_time
                  name: Bedtime goal
                  icon: mdi:bed
                # 4. Bedtime light reminder
                #- type: custom:button-card
                #  template: sleep_schedule_line
                #  entity: input_datetime.bedtime_trigger_weekends
                #  name: Blinds + audio intensifies
                #  icon: mdi:roller-shade
         
            # HEATED SHEET CONTROL
            #- type: custom:stack-in-card
            #  mode: vertical
            #  cards:
            #  - type: custom:timer-bar-card
            #    entity: timer.heated_sheet_timer
            #    name: "Heated sheet timer"
            #    invert: true
            #    bar_direction: rtl
            #    mushroom:
            #      layout: horizontal
            #      color: deep-orange
            #    card_mod:
            #      style: |
            #        ha-card {
            #          background-color: var(--nested-card-background);
            #        }
            #  - type: horizontal-stack
            #    cards:
            #    - type: tile
            #      entity: script.bedroom_heated_sheet_control
            #      color: white
            #      icon: mdi:chevron-up
            #      hide_state: true
            #      name: Timer +30 min
            #      tap_action:
            #        action: call-service
            #        service: script.bedroom_heated_sheet_control
            #        data:
            #          command: up
            #          increase: 00:30:00
            #      icon_tap_action:
            #        action: call-service
            #        service: script.bedroom_heated_sheet_control
            #        data:
            #          command: up
            #          increase: 00:30:00
            #    - type: tile
            #      entity: script.bedroom_heated_sheet_control
            #      color: white
            #      icon: mdi:chevron-down
            #      hide_state: true
            #      name: Timer -10 min
            #      tap_action:
            #        action: call-service
            #        service: script.bedroom_heated_sheet_control
            #        data:
            #          command: down
            #          decrease: 00:10:00
            #      icon_tap_action:
            #        action: call-service
            #        service: script.bedroom_heated_sheet_control
            #        data:
            #          command: down
            #          decrease: 00:10:00
        # CONTROLS
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              color_type: blank
              styles:
                card:
                  - background: transparent
            - type: custom:button-card
              icon: mdi:bed
              name: Bedtime
              template: light_mode
              entity: script.bedtime_lights
              tap_action:
                action: call-service
                service: script.turn_on
                data:
                  entity_id: script.bedtime_lights

#- type: custom:mushroom-template-card
#  entity: input_boolean.wakeup_alarm_active
#  icon: mdi:alarm-note
#  primary: Wake-up audio
#  secondary: |-
#    {% if is_state('input_boolean.wakeup_alarm_active', 'on') %}
#      {% set alarm_time = state_attr('switch.sonos_alarm_72', 'time') %}
#      Starts at {{ alarm_time.split(':')[0:2] | join(':') }}
#    {% else %}
#      Not active
#    {% endif %}
#  icon_color: |-
#    {% if is_state('input_boolean.wakeup_alarm_active', 'on') %}
#      white
#    {% else %}
#      disabled
#    {% endif %}
#  badge_icon: mdi:numeric-2-circle
#  badge_color: black
#  tap_action:
#    action: none
#  hold_action:
#    action: none
#  card_mod:
#    style: |
#      ha-card {
#        background-color: transparent !important;
#      }
 