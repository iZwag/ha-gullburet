title: Dashboard
path: dashboard
background: center / cover no-repeat url("/local/ui/bg-gradient3.png") fixed
type: "custom:ha-dashboard"
theme: ios-dark-mode
badges: []
usePanel: true
sidebar:
  screenMinWidth: 828
  buttons: []
  stickyCards:
    - type: picture-elements
      image: "/local/ui/clck-background.png"
      elements:
        - type: state-label
          entity: sensor.time
          hold_action:
            action: none
          style:
            color: var(--primary-text-color)
            font-size: 5.41vw
            font-weight: 200
            left: 16%
            letter-spacing: "-0.05vw"
            max-width: 1px
            top: 37.5%
            pointer-events: none
          tap_action:
            action: none
        - type: state-label
          entity: sensor.date_string
          hold_action:
            action: none
          style:
            color: var(--secondary-text-color)
            font-size: 1.3vw
            font-weight: 300
            left: 31.5%
            letter-spacing: "-0.05vw"
            text-align: left
            top: 65%
            width: 30%
            pointer-events: none
          tap_action:
            action: none
  cards:
    - type: custom:stack-in-card
      mode: vertical
      keep:
        border_radius: true
        margin: true
        box_shadow: true
        background: true
      card_mod:
        style: |
          ha-card {
            padding: 0% 1% 0% 1%;
          }
      cards:
        - type: "custom:button-card"
          icon: mdi:home
          name: Dashboard
          template: navbar_button
          variables:
            link_active: "true"
          tap_action:
            action: navigate
            navigation_path: /dashboard-tablet/dashboard
        - type: "custom:button-card"
          icon: mdi:floor-plan
          name: Floorplan control
          template: navbar_button
          tap_action:
            action: navigate
            navigation_path: /dashboard-tablet/floorplan
        - type: "custom:button-card"
          icon: mdi:bed
          name: Bedtime & wake-up
          template: navbar_button
          tap_action:
            action: navigate
            navigation_path: /dashboard-tablet/sleep
        - type: "custom:button-card"
          icon: mdi:chart-bar
          name: Consumption
          template: navbar_button
          tap_action:
            action: navigate
            navigation_path: /dashboard-tablet/consumption
        - type: "custom:button-card"
          icon: mdi:star
          name: Special
          template: navbar_button
          tap_action:
            action: navigate
            navigation_path: /dashboard-tablet/special
        - type: "custom:button-card"
          icon: mdi:speaker
          name: Listen
          template: navbar_button
          tap_action:
            action: navigate
            navigation_path: /dashboard-tablet/audio
        # VERTICAL SPACER ELEMENT: ADJUST THE HEIGHT AS NEEDED
        - type: "custom:button-card"
          color_type: blank_card
          styles:
            card:
              - height: 25vh
        - type: custom:mushroom-chips-card
          alignment: center
          card_mod:
            style: |
              ha-card {
                --chip-background: rgba(25, 25, 25, 0.2);
                --primary-text-color: var(--secondary-text-color);
              }
          chips:
          - type: action
            tap_action:
              action: navigate
              navigation_path: /lovelace/0
            icon: mdi:cog
          - type: entity
            entity: sensor.temperature_apartment_avg
          - type: weather
            entity: weather.yr_weather_home
            show_temperature: true
            show_conditions: true
cards:
  - type: "custom:bootstrap-grid-card"
    #container_padding: 10px
    #use_hass_style_gutter: true
    #hass_style_gutter_size: "10px"
    cards:
      # #####################################################################
      # FORECAST SECTION
      - type: row
        cards:
          - type: vertical-stack
            class: "col-xs-8 col-md-6 col-xxl-3"
            cards:
              - type: custom:weather-card
                entity: weather.yr_weather_home
                details: true
                hide_precipitation: false
                card_mod:
                  style: |
                    ha-card {
                      background-color: transparent;
                    }
          - type: vertical-stack
            class: "col-xs-8 col-md-6 col-xxl-3"
            #experimental:
            #  color_threshold: true
            cards:
              - type: custom:apexcharts-card
                card_mod:
                  style: |
                    ha-card {
                      background-color: transparent;
                    }
                apex_config:
                  legend:
                    show: false
                  grid:
                    show: true
                    borderColor: '#E0E0E0'
                  chart:
                    height: 350px
                  tooltip:
                    enabled: true
                    shared: true
                    hideEmptySeries: true
                    followCursor: true
                    intersect: false
                    x:
                      show: false
                  xaxis:
                    labels:
                      datetimeFormatter:
                        hour: HH
                  plotOptions:
                    bar:
                      columnWidth: 75%
                header:
                  show: true
                  title: 'Forecast - Electricity price & Weather'
                  show_states: true
                  colorize_states: true
                now:
                  show: true
                  #color: white
                  label: Now
                  color: '#9E9E9E'
                # TODO:
                # config-template-card this into '24h' before 13:00, '48h' after?
                graph_span: 48h 
                span:
                  start: day
                yaxis:
                  - id: kwh
                    decimals: 0
                    apex_config:
                      tickAmount: 5
                    min: ~20
                  - id: temp
                    opposite: true
                    decimals: 1
                    apex_config:
                      tickAmount: 5
                    min: ~0
                  - id: precip
                    opposite: true
                    decimals: 1
                    show: false
                    min: 0
                    max: ~5
                all_series_config:
                  extend_to: false
                  show:
                    name_in_header: false
                series:
                  - entity: sensor.tibber_prices
                    name: Tibber
                    show:
                      in_header: before_now
                    type: line
                    unit: ' øre/kWh'
                    curve: stepline
                    yaxis_id: kwh
                    stroke_width: 4
                    float_precision: 0
                    data_generator: |
                      const noon = new Date()
                      noon.setHours(0, 0, 0, 0)
                      const prices = entity.attributes.today.concat(entity.attributes.tomorrow);
                      const data = [];
                      for(let i = 0; i < prices.length; i++) {
                        data.push([noon.getTime() + i * 1000 * 3600, prices[i].total * 100])
                      }
                      return data;
                    #color_threshold:
                    #- value: 0
                    #  color: 4DD0E1
                    #- value: 10
                    #  color: 26A69A
                    #- value: 15
                    #  color: 4CAF50
                    #- value: 20
                    #  color: 7CB342
                    #- value: 25
                    #  color: FBC02D
                    #- value: 30
                    #  color: EF6C00
                    #- value: 40
                    #  color: B71C1C
                  - entity: sensor.yr_weather_forecast_hourly
                    name: Nedbør
                    yaxis_id: precip
                    type: column
                    unit: ' mm'
                    float_precision: 1
                    data_generator: |
                      return entity.attributes.forecast.map((entry) => {
                        return [new Date(entry.datetime).getTime(), entry.precipitation];
                      });
                  - entity: sensor.yr_weather_forecast_hourly
                    show:
                      in_header: raw
                    name: Temperatur, spådd
                    yaxis_id: temp
                    type: line
                    curve: smooth
                    unit: ' °C'
                    stroke_width: 5
                    float_precision: 1
                    color: '#9b59b6'
                    data_generator: |
                      return entity.attributes.forecast.map((entry) => {
                        return [new Date(entry.datetime).getTime(), entry.temperature];
                      });
                  - entity: sensor.temperature_outdoor
                    show:
                      in_header: false
                    extend_to: now
                    name: Temperatur
                    yaxis_id: temp
                    type: line
                    curve: smooth
                    unit: ' °C'
                    color: '#9b59b6'
                    float_precision: 1
      # #####################################################################
      # PUBLIC TRANSPORT SECTION
      # Row with 2x Ruter public transport departure boards
      - type: row
        cards:
          # 1st column departures
        - type: vertical-stack
          class: "col-xs-4 col-md-6 col-xxl-6"
          cards:
            # Swipe-carousel for tram and subway
          - type: custom:swipe-card
            start_card: 1
            reset_after: 600
            cards:
            # Sandaker Senter, trikk
            - type: custom:ruter-stop-info
              entities:
                - sensor.ruter_sandaker_senter_platform_11752
                - sensor.ruter_sandaker_senter_platform_11755
              show_departures: 3
              walking_distance: 4
            # Storo, t-bane
            - type: custom:ruter-stop-info
              entities:
                - sensor.ruter_storo_platform_1
                - sensor.ruter_storo_platform_2
              show_departures: 3
              walking_distance: 7
            - type: map
              entities:
                - entity: sensor.ruter_sandaker_senter_platform_11752
                  name: SandakerS.
                - entity: zone.home
                  label_mode: state
              default_zoom: 16
              aspect_ratio: 68%
              fit_zones: true
            - type: map
              entities:
                - entity: sensor.ruter_storo_platform_2
                  name: Storo
                - entity: zone.home
                  label_mode: state
              default_zoom: 14
              dark_mode: true
              aspect_ratio: 68%
              fit_zones: true
          # 2nd column departures
        - type: vertical-stack
          class: "col-xs-4 col-md-6 col-xxl-6"
          cards:
            # Swipe-carousel for buses
          - type: custom:swipe-card
            start_card: 1
            reset_after: 600
            cards:
              # Torshov, buss
            - type: "custom:ruter-stop-info"
              entities:
                - sensor.ruter_torshov_platform_11734
                - sensor.ruter_torshov_platform_11733
              show_departures: 3
              walking_distance: 7
              # Haarklous plass, buss
            - type: "custom:ruter-stop-info"
              entities:
                - sensor.ruter_haarklous_plass_platform_11766
                - sensor.ruter_haarklous_plass_platform_11768
              show_departures: 3
              walking_distance: 5
            - type: map
              entities:
                - entity: sensor.ruter_torshov_platform_11734
                  name: Torshov
                - entity: zone.home
                  label_mode: state
              default_zoom: 16
              aspect_ratio: 68%
              fit_zones: true
            - type: map
              entities:
                - entity: sensor.ruter_haarklous_plass_platform_11766
                  name: Haarklous
                - entity: zone.home
                  label_mode: state
              default_zoom: 16
              aspect_ratio: 68%
              fit_zones: true